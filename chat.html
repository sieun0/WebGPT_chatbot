<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <style>
    .chat-content { height: 700px; overflow-y: scroll;}
    .line { margin-top: 10px; display: flex;}
    .chat-box {background: #eee; padding: 5px; max-width: 200px;}
    .mine {margin-left: auto;}
  </style>
  <div class="chat-content">
    <div class="line">
      <span class="chat-box">안녕?</span>
    </div>
    <div class="line">
      <span class="chat-box mine">안녕!</span>
    </div>
  </div>
  <input class="chat-box" id="input">
  <button id="send">전송</button>
  
  <script type ="module">
    import { Configuration, OpenAIApi } from 'https://cdn.skypack.dev/openai';
    document.querySelector('#send').addEventListener('click', function(){
        var inputbox = `<div class="line">
            <span class="chat-box mine">${ document.querySelector('#input').value }</span>
        </div>`
        document.querySelector('.chat-content').insertAdjacentHTML('beforeend', inputbox);
        
        const configuration = new Configuration({
            apiKey: ''
        });
        const openai = new OpenAIApi(configuration);

        /*const response = [{'prompt':'삼성 이온 노트북의 가격은 얼마야?', 'completion':'삼성 이온 노트북'},
                            {'prompt':'2만원 이하의 장수 사과를 찾아줘.', 'completion':'장수 사과'},
                            {'prompt':'유통기한이 2023년 이내인 몰티져스 초콜릿을 찾아줘.', 'completion':'몰티져스 초콜릿'},
                            {'prompt':'5L 이상인 에어 프라이어를 보여줘.', 'completion':'에어 프라이어'},
                            {'prompt':'다이슨 청소기를 사고싶어. 가격을 알려줄래?', 'completion':'다이슨 청소기'},
                            {'prompt':'이니스프리 수분 선크림의 유통기한을 알려줘.', 'completion':'이니스프리 수분 선크림'},
                            {'prompt':'원피스를 사고싶어. 추천해줘.', 'completion':'원피스'},
                            {'prompt':'보라카이의 리조트를 가고 싶어.', 'completion':'보라카이 리조트'},
                            {'prompt':'맛있는 김치를 먹을까 하는데, 어디 브랜드가 좋을까?', 'completion':'맛있는 김치'},
                            {'prompt':'나이키 브랜드의 슬리퍼를 구매하고 싶어. 제일 저렴한 게 뭐야?', 'completion':'나이키 슬리퍼'},
                            {'prompt':'비 오는 날에는 장화를 신어야겠지?', 'completion':'장화'},
                            {'prompt':'안주로 오징어가 땡기네. 반건조 오징어 배송 오래 걸리나?', 'completion':'반건조 오징어'},
                            {'prompt':'여성여름바지사고싶어. 가격추천해줘.', 'completion':'여성여름바지'},
                            {'prompt':'아이패드프로12인치 몇키로야??', 'completion':'아이패드프로12인치'},
                            {'prompt':'갤럭시 탭 케이스 얼마 정도 해?', 'completion':'갤럭시 탭 케이스'},
                            {'prompt':'제일 당류가 적은 커피는 ??', 'completion':'커피'}
                        ];*/
    
        const messages = [
                    {'role':'system', 'content':'You are an AI that only extracts keyword words from sentences to search on the website. You are extract only words that are not in sentence form. For example, in the sentence "1Kg 이하의 삼성 이온 노트북의 가격을 비교해줘", the keyword word is "삼성 이온 노트북".'},
                    {'role':'user', 'content':'2만원 이하의 장수 사과를 찾아줘.'},
                    {'role':'assistant', 'content':'장수 사과'},
                    {'role':'user', 'content':'보라카이의 리조트를 가고 싶어'},
                    {'role':'assistant', 'content':'보라카이 리조트'},
                    {'role':'user', 'content':'여성여름바지사고싶어. 가격추천해줘.'},
                    {'role':'assistant', 'content':'여성여름바지'},
                    {'role':'user', 'content':'다이슨 청소기를 사고싶어. 가격을 알려줄래?'},
                    {'role':'assistant', 'content':'다이슨 청소기'},
                    {'role':'user', 'content':'여성여름 바지 가격 비교'},
                    {'role':'assistant', 'content':'여성여름 바지'},
                    {'role':'user', 'content':'제일 당류가 적은 커피는 ???'},
                    {'role':'assistant', 'content':'커피'},
                    {'role':'user', 'content':'나이키 브랜드의 슬리퍼를 구매하고 싶어. 제일 저렴한 게 뭐야?'},
                    {'role':'assistant', 'content':'나이키 슬리퍼'},
                    {'role': 'user', 'content': document.querySelector('#input').value},
                    //{'role':'assistant', 'content': {'prompt':'5L 이상인 에어 프라이어를 보여줘.', 'completion':'에어 프라이어'}}
                    ]
        
        /*for(let i=0; i<response.length; i++) {
            messages.push({'role':'assistant', 'content':response[i].completion});
        }*/               
        
        openai.createChatCompletion({
        model: "gpt-3.5-turbo",
        //prompt: document.querySelector('#input').value,
        messages: messages
        /*temperature: 0.7,
        max_tokens: 500,
        top_p: 1,
        frequency_penalty: 0,
        presence_penalty: 0,*/
        }).then((result)=>{
            console.log(result.data.choices[0].message.content)
            var outputbox = `<div class="line">
                <span class="chat-box">${ result.data.choices[0].message.content }</span>
            </div>`
            document.querySelector('.chat-content').insertAdjacentHTML('beforeend', outputbox);

            /*const assistantMessages = messages.concat({'role':'assistant', 'content':result.data.choices[0].text});
            assistantMessages.forEach((message) => {
            assistant.appendMessage(message.role, message.content);
            })*/
        
        })
    })
  </script>
</body>
</html>


